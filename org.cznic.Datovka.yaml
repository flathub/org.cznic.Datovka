app-id: org.cznic.Datovka
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '6.5'
command: datovka
rename-desktop-file: datovka.desktop
rename-appdata-file: datovka.metainfo.xml
rename-icon: datovka

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri
  - --talk-name=org.freedesktop.Notifications

modules:
  - name: libxml2
    config-opts:
        - --without-python
    sources:
        - type: archive
          url: https://download.gnome.org/sources/libxml2/2.10/libxml2-2.10.4.tar.xz
          sha256: ed0c91c5845008f1936739e4eee2035531c1c94742c6541f44ee66d885948d45

  - name: libdatovka
    config-opts:
        - --disable-doc
        - --disable-static
    sources:
        - type: archive
          url: https://secure.nic.cz/files/datove_schranky/libdatovka/libdatovka-0.3.0.tar.xz
          sha256: c69905a1be69774a6956a8145c1631d453de162caaef1769c692501c2340261b

  - name: qt5compat
    buildsystem: cmake-ninja
    cleanup-platfom: /bin
    post-install:
        - "ln -sr ${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/libQt*.so* -t ${FLATPAK_DEST}/lib/"
    sources:
        - type: archive
          url: https://download.qt.io/official_releases/qt/6.5/6.5.2/submodules/qt5compat-everywhere-src-6.5.2.tar.xz
          sha256: b9abe42ee2055c27a8e7579c7816069e91aae1f9b10649bf572db8ba96fa91c4

  - name: quazip
    buildsystem: cmake-ninja
    sources:
        - type: archive
          url: https://github.com/stachenov/quazip/archive/refs/tags/v1.4.tar.gz
          sha256: 79633fd3a18e2d11a7d5c40c4c79c1786ba0c74b59ad752e8429746fe1781dd6

  - name: datovka
    buildsystem: qmake
    post-install:
        - mv /app/bin/datovka /app/bin/datovka-run
        - install -m755 datovka-script /app/bin/datovka
    sources:
        - type: archive
          url: https://secure.nic.cz/files/datove_schranky/4.22.1/datovka-4.22.1.tar.xz
          sha256: f7b043d2f887951a9719e8c8d1b1585cc716dbea3474a09bf1fd2667d63a2fdc
        - type: patch
          path: datovka.patch
        - type: patch
          path: appdata.patch
        - type: patch
          path: paths.patch
        - type: script
          dest-filename: datovka-script
          commands: 
            - exec env TMPDIR=$XDG_CACHE_HOME /app/bin/datovka-run "$@"  
cleanup:
  - "*.a"
  - "*.la"
  - "*.cmake"
  - "*.pc"
  - "/bin/xml*"
  - /include
  - /share/aclocal
  - "/share/doc/libxml*"
  - /share/gtk-doc
  - /share/man
